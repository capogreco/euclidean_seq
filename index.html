<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Euclidean Tone Generator</title>
        <link rel="stylesheet" href="/src/frontend/styles.css" />
        <script type="module" src="/src/frontend/main.js" defer></script>
    </head>
    <body>
        <!-- Connection status removed - client-side only -->

        <h1>Euclidean Tone Generator</h1>

        <div class="sequence-section">
            <div class="sequence-header">
                <h2>PATTERN & PLAYBACK</h2>
            </div>
            <div class="sequence-visualization">
                <!-- Sequence visualization will go here -->
            </div>
            <div class="oscilloscope-section">
                <h3>FORMANT OSCILLOSCOPE</h3>
                <canvas id="xyOscilloscope"></canvas>
                <div class="oscilloscope-controls">
                    <button id="toggleOscilloscope" class="play-button">● Start Scope</button>
                    <label>
                        <input type="range" id="scopeGain" min="1" max="10" value="3" step="0.5">
                        Gain
                    </label>
                    <label>
                        <input type="range" id="scopeSamples" min="16" max="128" value="64" step="8">
                        Samples/Frame
                    </label>
                </div>
            </div>
            <div class="sequence-controls">
                <div class="sequence-control-group">
                    <h3>Tempo</h3>
                    <div class="control">
                        <label>BPM</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="bpm"
                                data-delta="-5"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="bpmValue"
                                data-min="60"
                                data-max="200"
                                data-default="120"
                            >
                                120
                            </div>
                            <button
                                class="value-btn"
                                data-target="bpm"
                                data-delta="5"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control">
                        <label>Subdivision</label>
                        <div class="value-control">
                            <button class="value-btn" data-target="subdivision" data-delta="-1">-</button>
                            <span class="value-display" id="subdivisionValue" data-min="1" data-max="32" data-default="4">4</span>
                            <button class="value-btn" data-target="subdivision" data-delta="1">+</button>
                        </div>
                    </div>
                </div>

                <div class="sequence-control-group">
                    <h3>Pattern</h3>
                    <div class="control">
                        <label>Mode</label>
                        <select id="synthMode" style="width: 100%">
                            <option value="mono">Mono</option>
                            <option value="poly">Poly</option>
                        </select>
                    </div>
                    <div class="control" id="patternStepsControl">
                        <label>Steps</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="patternSteps"
                                data-delta="-1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="patternStepsValue"
                                data-min="4"
                                data-max="32"
                                data-default="16"
                            >
                                16
                            </div>
                            <button
                                class="value-btn"
                                data-target="patternSteps"
                                data-delta="1"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control">
                        <label>Order</label>
                        <select id="sequenceOrder" style="width: 100%">
                            <option value="forward">Forward</option>
                            <option value="reverse">Reverse</option>
                            <option value="shuffle">Shuffle</option>
                        </select>
                    </div>
                    <div
                        class="control"
                        id="sequenceShuffleControl"
                        style="display: none"
                    >
                        <button
                            class="play-button"
                            id="reshuffleButton"
                            style="background: #fff"
                        >
                            ↻ Reshuffle
                        </button>
                    </div>
                </div>

                <div
                    class="sequence-control-group poly-only"
                    style="display: none"
                >
                    <h3>Rhythm</h3>
                    <div class="control">
                        <label>Pulses</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="rhythmPulses"
                                data-delta="-1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="rhythmPulsesValue"
                                data-min="1"
                                data-max="16"
                                data-default="8"
                            >
                                8
                            </div>
                            <button
                                class="value-btn"
                                data-target="rhythmPulses"
                                data-delta="1"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control">
                        <label>Rotation</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="rhythmRotation"
                                data-delta="-1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="rhythmRotationValue"
                                data-min="0"
                                data-max="15"
                                data-default="0"
                            >
                                0
                            </div>
                            <button
                                class="value-btn"
                                data-target="rhythmRotation"
                                data-delta="1"
                            >
                                +
                            </button>
                        </div>
                    </div>
                </div>

                <div class="sequence-control-group mono-only">
                    <h3>Portamento</h3>
                    <div class="control">
                        <label>Time (%)</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="portamentoTime"
                                data-delta="-5"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="portamentoTimeValue"
                                data-min="0"
                                data-max="100"
                                data-default="50"
                            >
                                50
                            </div>
                            <button
                                class="value-btn"
                                data-target="portamentoTime"
                                data-delta="5"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control">
                        <label>Steps</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="portamentoSteps"
                                data-delta="-1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="portamentoStepsValue"
                                data-min="0"
                                data-max="16"
                                data-default="4"
                            >
                                4
                            </div>
                            <button
                                class="value-btn"
                                data-target="portamentoSteps"
                                data-delta="1"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control">
                        <label>Rotation</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="portamentoRotation"
                                data-delta="-1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="portamentoRotationValue"
                                data-min="0"
                                data-max="15"
                                data-default="0"
                            >
                                0
                            </div>
                            <button
                                class="value-btn"
                                data-target="portamentoRotation"
                                data-delta="1"
                            >
                                +
                            </button>
                        </div>
                    </div>
                </div>

                <div
                    class="sequence-control-group poly-only"
                    style="display: none"
                >
                    <h3>Envelope</h3>
                    <div class="control">
                        <label>Attack (ms)</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="attackTime"
                                data-delta="-5"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="attackTimeValue"
                                data-min="0"
                                data-max="100"
                                data-default="5"
                            >
                                5
                            </div>
                            <button
                                class="value-btn"
                                data-target="attackTime"
                                data-delta="5"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control">
                        <label>Decay (ms)</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="decayTime"
                                data-delta="-10"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="decayTimeValue"
                                data-min="50"
                                data-max="500"
                                data-default="200"
                            >
                                200
                            </div>
                            <button
                                class="value-btn"
                                data-target="decayTime"
                                data-delta="10"
                            >
                                +
                            </button>
                        </div>
                    </div>
                </div>

                <div class="sequence-control-group">
                    <h3>Vowel Synthesis</h3>
                    <div class="control vowel-control">
                        <label>Synth Blend</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="synthBlend"
                                data-delta="-0.05"
                                data-precision="2"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="synthBlendValue"
                                data-min="0"
                                data-max="1"
                                data-default="0.5"
                                data-precision="2"
                            >
                                0.50
                            </div>
                            <button
                                class="value-btn"
                                data-target="synthBlend"
                                data-delta="0.05"
                                data-precision="2"
                            >
                                +
                            </button>
                        </div>
                        <div class="blend-label">0=Formant, 1=Zing</div>
                    </div>
                    <div class="control vowel-control">
                        <label>Morph (Zing Path)</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="morph"
                                data-delta="-0.1"
                                data-precision="1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="morphValue"
                                data-min="-1"
                                data-max="1"
                                data-default="0"
                                data-precision="1"
                            >
                                0.0
                            </div>
                            <button
                                class="value-btn"
                                data-target="morph"
                                data-delta="0.1"
                                data-precision="1"
                            >
                                +
                            </button>
                        </div>
                        <div class="morph-label" id="morphLabel">Ring Modulation</div>
                    </div>
                    <div class="control vowel-control">
                        <label>Symmetry</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="symmetry"
                                data-delta="-0.01"
                                data-precision="2"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="symmetryValue"
                                data-min="0"
                                data-max="1"
                                data-default="0.5"
                                data-precision="2"
                            >
                                0.50
                            </div>
                            <button
                                class="value-btn"
                                data-target="symmetry"
                                data-delta="0.01"
                                data-precision="2"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control vowel-control">
                        <label>Phoneme Steps</label>
                        <div class="value-control">
                            <button
                                class="value-btn"
                                data-target="phonemeSteps"
                                data-delta="-1"
                            >
                                −
                            </button>
                            <div
                                class="value-display"
                                id="phonemeStepsValue"
                                data-min="1"
                                data-max="32"
                                data-default="5"
                            >
                                5
                            </div>
                            <button
                                class="value-btn"
                                data-target="phonemeSteps"
                                data-delta="1"
                            >
                                +
                            </button>
                        </div>
                    </div>
                    <div class="control vowel-control">
                        <label>Manual Vowel</label>
                        <select id="vowelPreset" style="width: 100%">
                            <option value="sequence">Use Sequence</option>
                            <option value="a">/a/ (father)</option>
                            <option value="e">/e/ (bet)</option>
                            <option value="i">/i/ (beat)</option>
                            <option value="o">/o/ (bought)</option>
                            <option value="u">/u/ (boot)</option>
                        </select>
                    </div>
                    <div class="control vowel-control">
                        <button
                            class="play-button"
                            id="regeneratePhonemes"
                            style="background: #fff"
                        >
                            ↻ New Phonemes
                        </button>
                    </div>
                </div>

                <button
                    class="play-button"
                    id="playSequence"
                    style="width: 100px; height: 40px; font-size: 16px"
                >
                    ▶ Play
                </button>
            </div>
        </div>

        <div class="main-container">
            <div class="global-settings">
                <h2>SETTINGS</h2>
                <div class="control">
                    <label>EDO (Base Tones)</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="edo"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="edoValue"
                            data-min="5"
                            data-max="24"
                            data-default="12"
                        >
                            12
                        </div>
                        <button
                            class="value-btn"
                            data-target="edo"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div class="control">
                    <label>Root Note</label>
                    <select
                        id="rootMode"
                        style="width: 100%; margin-bottom: 4px"
                    >
                        <option value="hz">Hz</option>
                        <option value="midi">MIDI</option>
                    </select>
                    <input
                        type="number"
                        id="rootFreq"
                        value="261.63"
                        step="0.01"
                        style="width: 100%"
                    />
                    <select
                        id="rootMidi"
                        style="width: 100%; display: none"
                    ></select>
                </div>
            </div>
            <div class="tone-column">
                <div class="column-title">BASE TONES</div>
                <div class="tones-display" id="baseTones"></div>
                <button class="play-button" id="playBase">▶ Play</button>
            </div>

            <div class="euclidean-control">
                <h3>EUCLIDEAN 1</h3>
                <div class="control">
                    <label>Notes</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="scaleNotes"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="scaleNotesValue"
                            data-min="1"
                            data-max="12"
                            data-default="7"
                        >
                            7
                        </div>
                        <button
                            class="value-btn"
                            data-target="scaleNotes"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div class="control">
                    <label>Rotation</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="scaleRotation"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="scaleRotationValue"
                            data-min="0"
                            data-max="6"
                            data-default="0"
                        >
                            0
                        </div>
                        <button
                            class="value-btn"
                            data-target="scaleRotation"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
            </div>

            <div class="tone-column">
                <div class="column-title">SCALE TONES</div>
                <div class="tones-display" id="scaleTones"></div>
                <button class="play-button" id="playScale">▶ Play</button>
            </div>

            <div class="euclidean-control">
                <h3>EUCLIDEAN 2</h3>
                <div class="control">
                    <label>Notes</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="chordNotes"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="chordNotesValue"
                            data-min="1"
                            data-max="7"
                            data-default="3"
                        >
                            3
                        </div>
                        <button
                            class="value-btn"
                            data-target="chordNotes"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div class="control">
                    <label>Rotation</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="chordRotation"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="chordRotationValue"
                            data-min="0"
                            data-max="2"
                            data-default="0"
                        >
                            0
                        </div>
                        <button
                            class="value-btn"
                            data-target="chordRotation"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
            </div>

            <div class="tone-column">
                <div class="column-title">CHORD TONES</div>
                <div class="tones-display" id="chordTones"></div>
                <button class="play-button" id="playChord">▶ Play</button>
            </div>

            <div class="euclidean-control">
                <h3>TONE SELECTION</h3>
                <div class="control">
                    <label>Base</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="sequenceBase"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="sequenceBaseValue"
                            data-min="-2"
                            data-max="2"
                            data-default="0"
                        >
                            0
                        </div>
                        <button
                            class="value-btn"
                            data-target="sequenceBase"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div class="control">
                    <label>Octaves</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="sequenceOctaves"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="sequenceOctavesValue"
                            data-min="1"
                            data-max="4"
                            data-default="2"
                        >
                            2
                        </div>
                        <button
                            class="value-btn"
                            data-target="sequenceOctaves"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div class="control">
                    <label>Notes</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="sequenceNotes"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="sequenceNotesValue"
                            data-min="1"
                            data-max="6"
                            data-default="6"
                        >
                            6
                        </div>
                        <button
                            class="value-btn"
                            data-target="sequenceNotes"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div class="control">
                    <label>Method</label>
                    <select id="sequenceMethod" style="width: 100%">
                        <option value="euclidean">Euclidean</option>
                        <option value="random">Random</option>
                    </select>
                </div>
                <div
                    class="control"
                    id="sequenceRotationControl"
                    style="display: block"
                >
                    <label>Rotation</label>
                    <div class="value-control">
                        <button
                            class="value-btn"
                            data-target="sequenceRotation"
                            data-delta="-1"
                        >
                            −
                        </button>
                        <div
                            class="value-display"
                            id="sequenceRotationValue"
                            data-min="0"
                            data-max="7"
                            data-default="0"
                        >
                            0
                        </div>
                        <button
                            class="value-btn"
                            data-target="sequenceRotation"
                            data-delta="1"
                        >
                            +
                        </button>
                    </div>
                </div>
                <div
                    class="control"
                    id="sequenceRandomizeControl"
                    style="display: none"
                >
                    <button
                        id="randomizeSequence"
                        style="
                            width: 100%;
                            padding: 8px;
                            background: #000;
                            color: #fff;
                            border: none;
                            cursor: pointer;
                        "
                    >
                        Randomize
                    </button>
                </div>
            </div>

            <div class="tone-column">
                <div class="column-title">SELECTED TONES</div>
                <div class="tones-display" id="sequenceTones"></div>
                <button class="play-button" id="playSequenceTones">
                    ▶ Play
                </button>
            </div>
        </div>

    </body>
</html>
